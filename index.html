<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" href="joint.css"/>
    <script src="jquery.min.js"></script>
    <script src="lodash.min.js"></script>
    <script src="backbone-min.js"></script>
    <script src="joint.js"></script>
    <title>OPCloud Example With JointJS</title>
    <h1>OPCloud Example With JointJS</h1>
</head>
<body>
<div id="myholder" align="center"></div>
<script type="text/javascript">

    var graph = new joint.dia.Graph;
    //Working Desktop
    var paper = new joint.dia.Paper({
        el: $('#myholder'),
        width: 1800,
        height: 1000,
        model: graph,
        gridSize: 1
    });

    var rect = new joint.shapes.basic.Rect({
        position: {x: 250, y: 100},
        size: {width: 100, height: 50},
        attrs: {rect: {fill: '#DCDCDC', stroke:'#006400'} , text: {text: 'Object', fill: 'black'}}
    });

    var rect2 = rect.clone();
    rect2.translate(400);

    var elli = new joint.shapes.basic.Ellipse({
        position: {x: 450, y: 100},
        size: {width: 100, height: 50},
        attrs: {ellipse: {fill: '#DCDCDC', stroke:'#00008B'}, text: {text: 'Process', fill: 'black'}}
    });

    var link1 = new joint.dia.Link({
        source: {id: rect.id},
        target: {id: elli.id},
        attrs: {'.marker-target': {fill: 'white', d: 'M 10 0 L 0 5 L 10 10 z'}}
    });

    var link2 = new joint.dia.Link({
        source: {id: elli.id},
        target: {id: rect2.id},
        attrs: {'.marker-target': {fill: 'white', d: 'M 10 0 L 0 5 L 10 10 z'}}
    });
    //Object with states
    var StatefullObj = new joint.shapes.basic.Rect({
        position: {x: 20, y: 20},
        size: {width: 300, height: 70},
        attrs: {rect: {fill: '#DCDCDC', stroke:'#006400'} , text: {text: 'Object', fill: 'black'}}
    });
    var State1 = new joint.shapes.basic.Rect({
        position: {x: 50, y: 60},
        size: {width: 50, height: 20},
        attrs: {rect: {fill: '#DCDCDC', stroke:'#006400'} , text: {text: 'Object', fill: 'black'}}
    });

    var State2 = new joint.shapes.basic.Rect({
        position: {x: 150, y: 60},
        size: {width: 50, height: 20},
        attrs: {rect: {fill: '#DCDCDC', stroke:'#006400'} , text: {text: 'Object', fill: 'black'}}
    });
    var State3 = new joint.shapes.basic.Rect({
        position: {x: 250, y: 60},
        size: {width: 50, height: 20},
        attrs: {rect: {fill: '#DCDCDC', stroke:'#006400'} , text: {text: 'Object', fill: 'black'}}
    });

    StatefullObj.embed(State1);
    StatefullObj.embed(State2);
    StatefullObj.embed(State3);

    //link1.set('smooth',true);
    //link2.set('smooth',true);
    //graph.addCells([StatefullObj, state1, state2, state3]);
    graph.addCells([StatefullObj, State1, State2, State3, rect, rect2, elli, link1, link2]);

    graph.on('change:position', function (cell) {

        var parentId = cell.get('parent');
        if (!parentId) return;

        var parent = graph.getCell(parentId);
        var parentBbox = parent.getBBox();
        var cellBbox = cell.getBBox();

        if (parentBbox.containsPoint(cellBbox.origin()) &&
                parentBbox.containsPoint(cellBbox.topRight()) &&
                parentBbox.containsPoint(cellBbox.corner()) &&
                parentBbox.containsPoint(cellBbox.bottomLeft())) {

            // All the four corners of the child are inside
            // the parent area.
            return;
        }

        // Revert the child position.
        cell.set('position', cell.previous('position'));
    });

</script>
</body>
</html>

